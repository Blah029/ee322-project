MPASM 5.77                      MAINCODE.ASM   8-14-2021  20:31:35         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ;-------------------------------------------------------------------------------
                      00002 ; EE322 Embedded Systems Design
                      00003 ; Year 3 Semester 1
                      00004 ; Group Project
                      00005 ; Title: Coin Sorter and Calculator
                      00006 ; 
                      00007 ; Group G1
                      00008 ;    E/17/146: Jayawickrama, J.P.D.D.M.
                      00009 ;    E/17/234: Pandukabhaya, V.K.M.
                      00010 ;    E/17/371: Warnakulasuriya, R.
                      00011 ;-------------------------------------------------------------------------------
                      00012 
                      00013 ;-------------------------------------------------------------------------------
                      00014 ; Header
                      00015 #include <p16f84a.inc>                  ; Include file for register names
                      00001         LIST
                      00002 
                      00003 ;==========================================================================
                      00004 ; Build date : Nov 22 2017
                      00005 ;  MPASM PIC16F84A processor include
                      00006 ; 
                      00007 ;  (c) Copyright 1999-2017 Microchip Technology, All rights reserved
                      00008 ;==========================================================================
                      00009 
                      00209         LIST
                      00016         list        p = 16f84a          ; Microcontroller model
                      00017 ;-------------------------------------------------------------------------------
                      00018 
                      00019 ;-------------------------------------------------------------------------------
                      00020 ; Pin Designations
                      00021 
                      00022 ;-------------------------------------------------------------------------------
                      00023 
                      00024 ;-------------------------------------------------------------------------------
                      00025 ; Variables
                      00026 ; Counter variables
  0000000C            00027 count1  equ         0x0c                ; used in a decfsz
  0000000D            00028 count2  equ         0x0d                ; used in a decfsz
  0000000E            00029 count3  equ         0x0e                ; used in a decfsz
                      00030 ;-------------------------------------------------------------------------------
                      00031 
                      00032 ;-------------------------------------------------------------------------------
                      00033 ; Constants
                      00034 
                      00035 ;-------------------------------------------------------------------------------
                      00036 
                      00037 ;-------------------------------------------------------------------------------
                      00038 ; Define origin and interrupt vectors
                      00039         org         0x000               ; Origin
0000   2???           00040         goto        INIT
                      00041         
                      00042         org         0x04                ; Interrupt vector
0004   2???           00043         goto        ISR                 ; Unimplemented
MPASM 5.77                      MAINCODE.ASM   8-14-2021  20:31:35         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00044 ;-------------------------------------------------------------------------------
                      00045 
                      00046 ;-------------------------------------------------------------------------------
                      00047 ; Routine "INIT"
                      00048 ;       Executed once. Configures settings in PIC.
                      00049 
0005                  00050 INIT:
0005   1683           00051         bsf         STATUS, RP0         ; Bank 1 select (bit 5)
                      00052 
                      00053 ; Set Interrupt Settings
0006   160B           00054         bsf         INTCON, INTE        ; Enable the RB0/INT interrupt
                      00055         
0007   178B           00056         bsf         INTCON, GIE         ; Enable all un-masked (global)
                      00057                                         ; interrupts
                      00058                                     
0008   108B           00059         bcf         INTCON, INTF        ; Clear the RB0/INT flag
                      00060         
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0009   1701           00061         bsf         OPTION_REG, INTEDG  ; Interrupt on rising edge of
                      00062                                         ; RB0/INT pin
                      00063 
                      00064 ; PORTA, PORTB pin modes
000A   30FF           00065         movlw       b'11111111'         ; PORTB I/O pattern
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
000B   0086           00066         movwf       TRISB               ; Set PORTB pin modes
                      00067         
000C   3000           00068         movlw       b'00000'            ; PORTA I/O pattern
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
000D   0085           00069         movwf       TRISA               ; Set PORTA pin modes
                      00070         
000E   1283           00071         bcf         STATUS, 5           ; Bank 0 select
                      00072 
                      00073 ; Initialize PORTA and PORTB
000F   3000           00074         movlw       b'00000000'
0010   0086           00075         movwf       PORTB
0011   3000           00076         movlw       b'00000'
0012   0085           00077         movwf       PORTA
                      00078         
                      00079 ;-------------------------------------------------------------------------------
                      00080 
                      00081 ;-------------------------------------------------------------------------------
                      00082 ; Routine "MAIN"
0013                  00083 MAIN:
                      00084         ;Tip the platform +30
0013   3004           00085         movlw       b'00000100'         ; turn on RA2
0014   0085           00086         movwf       PORTA               ; 
0015   2???           00087         call        MOTOR_PLUS30_ON     ;
                      00088         
0016   3000           00089         movlw       b'00000000'         ; turn off RA2
0017   0085           00090         movwf       PORTA               ; 
0018   2???           00091         call        MOTOR_PLUS30_OFF    ;
                      00092         
0019   2???           00093         call        DELAY_1S
MPASM 5.77                      MAINCODE.ASM   8-14-2021  20:31:35         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00094         
                      00095         ;Make the platform horizontal
001A   3004           00096         movlw       b'00000100'         ; turn on RA2
001B   0085           00097         movwf       PORTA               ; 
001C   2???           00098         call        MOTOR_0_ON          ;
                      00099         
001D   3000           00100         movlw       b'00000000'         ; turn off RA2
001E   0085           00101         movwf       PORTA               ; 
001F   2???           00102         call        MOTOR_0_OFF         ;
                      00103         
0020   2???           00104         call        DELAY_1S
                      00105         
                      00106         ;Tip the platform -30
0021   3004           00107         movlw       b'00000100'         ; turn on RA2
0022   0085           00108         movwf       PORTA               ; 
0023   2???           00109         call        MOTOR_MINUS30_ON    ;
                      00110         
0024   3000           00111         movlw       b'00000000'         ; turn off RA2
0025   0085           00112         movwf       PORTA               ; 
0026   2???           00113         call        MOTOR_MINUS30_OFF   ;
                      00114         
0027   2???           00115         call        DELAY_1S
                      00116         
                      00117         ;Make the platform horizontal
0028   3004           00118         movlw       b'00000100'         ; turn on RA2
0029   0085           00119         movwf       PORTA               ; 
002A   2???           00120         call        MOTOR_0_ON          ;
                      00121         
002B   3000           00122         movlw       b'00000000'         ; turn off RA2
002C   0085           00123         movwf       PORTA               ; 
002D   2???           00124         call        MOTOR_0_OFF         ;
                      00125         
002E   2???           00126         call        DELAY_1S
                      00127         
002F   2???           00128         goto        INF_LOOP            ; Go to the MAIN routine again (loop)
                      00129 
                      00130 ;-------------------------------------------------------------------------------
                      00131 ; Subroutine "READ_SENSOR_VALUE"
0030                  00132 READ_SENSOR_VALUE:
                      00133 ;        unsigned long Count;
                      00134 ;        unsigned char i;
                      00135 ;        pinMode(DT, OUTPUT);
                      00136 ;        digitalWrite(DT,HIGH);
                      00137 ;        digitalWrite(SCK,LOW);
                      00138 ;        Count=0
                      00139 ;        pinMode(DT, INPUT);
                      00140 ;        while(digitalRead(DT));
                      00141 ;        for (i=0;i<24;i++)
                      00142 ;        {
                      00143 ;          digitalWrite(SCK,HIGH);
                      00144 ;          Count=Count<<1;
                      00145 ;          digitalWrite(SCK,LOW);
                      00146 ;          if(digitalRead(DT)) 
MPASM 5.77                      MAINCODE.ASM   8-14-2021  20:31:35         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00147 ;          Count++;
                      00148 ;        }
                      00149 ;        digitalWrite(SCK,HIGH);
                      00150 ;        Count=Count^0x800000;
                      00151 ;        digitalWrite(SCK,LOW);
                      00152 ;        return(Count);
                      00153     
0030   0008           00154         return
                      00155         
                      00156 ;-------------------------------------------------------------------------------
                      00157 ; ISR ""
0031                  00158 ISR:
                      00159         ; Interrupt occurred
0031   0009           00160         retfie                          ; Return from interrupt
                      00161 ;-------------------------------------------------------------------------------
                      00162         
                      00163 ;-------------------------------------------------------------------------------
                      00164 ; Delay subroutine (general)
                      00165 ; T = 18 + (count1-1)*3 + (count2-1)*770 + (count3-1)*197140 ns
0032                  00166 DELAY
Message[305]: Using default destination of 1 (file).
0032   0B8C           00167         decfsz      count1
0033   2???           00168         goto        DELAY
                      00169         
Message[305]: Using default destination of 1 (file).
0034   0B8D           00170         decfsz      count2
0035   2???           00171         goto        DELAY
                      00172         
Message[305]: Using default destination of 1 (file).
0036   0B8E           00173         decfsz      count3
0037   2???           00174         goto        DELAY
                      00175         
0038   0008           00176         return
                      00177 
                      00178 ;-------------------------------------------------------------------------------
                      00179 
                      00180 ;-------------------------------------------------------------------------------
                      00181 ; Motor Controller subroutines
                      00182 
0039                  00183 MOTOR_PLUS90_ON:
0039   3095           00184         movlw       d'149'              ; set layer 1 delay counter
003A   008C           00185         movwf       count1              ; 
003B   3003           00186         movlw       d'3'                ; set layer 2 delay counter
003C   008D           00187         movwf       count2              ; 
003D   3001           00188         movlw       d'1'                ; set layer 3 delay counter
003E   008E           00189         movwf       count3              ; 
003F   2???           00190         call        DELAY               ; 90deg on time
                      00191         
0040   0008           00192         return
                      00193         
0041                  00194 MOTOR_PLUS90_OFF:
0041   3001           00195         movlw       d'1'                ; set layer 1 delay counter
0042   008C           00196         movwf       count1              ; 
MPASM 5.77                      MAINCODE.ASM   8-14-2021  20:31:35         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0043   3001           00197         movlw       d'1'                ; set layer 2 delay counter
0044   008D           00198         movwf       count2              ; 
0045   3003           00199         movlw       d'3'                ; set layer 3 delay counter
0046   008E           00200         movwf       count3              ; 
0047   2???           00201         call        DELAY               ; 90deg off time
                      00202         
0048   0008           00203         return
                      00204 
0049                  00205 MOTOR_0_ON:
0049   30EE           00206         movlw       d'238'              ; set layer 1 delay counter
004A   008C           00207         movwf       count1              ; 
004B   3002           00208         movlw       d'2'                ; set layer 2 delay counter
004C   008D           00209         movwf       count2              ; 
004D   3001           00210         movlw       d'1'                ; set layer 3 delay counter
004E   008E           00211         movwf       count3              ; 
004F   2???           00212         call        DELAY               ; 0deg on time
                      00213         
0050   0008           00214         return
                      00215         
0051                  00216 MOTOR_0_OFF:
0051   30A1           00217         movlw       d'161'              ; set layer 1 delay counter
0052   008C           00218         movwf       count1              ; 
0053   3001           00219         movlw       d'1'                ; set layer 2 delay counter
0054   008D           00220         movwf       count2              ; 
0055   3001           00221         movlw       d'1'                ; set layer 3 delay counter
0056   008E           00222         movwf       count3              ; 
0057   2???           00223         call        DELAY               ; 0deg off time
                      00224         
0058   0008           00225         return
                      00226         
0059                  00227 MOTOR_MINUS30_ON:
0059   30B7           00228         movlw       d'183'              ; set layer 1 delay counter
005A   008C           00229         movwf       count1              ; 
005B   3002           00230         movlw       d'2'                ; set layer 2 delay counter
005C   008D           00231         movwf       count2              ; 
005D   3001           00232         movlw       d'1'                ; set layer 3 delay counter
005E   008E           00233         movwf       count3              ; 
005F   2???           00234         call        DELAY               ; -30deg on time
                      00235         
0060   0008           00236         return
                      00237         
0061                  00238 MOTOR_MINUS30_OFF:
0061   30D9           00239         movlw       d'217'              ; set layer 1 delay counter
0062   008C           00240         movwf       count1              ; 
0063   3001           00241         movlw       d'1'                ; set layer 2 delay counter
0064   008D           00242         movwf       count2              ; 
0065   3001           00243         movlw       d'1'                ; set layer 3 delay counter
0066   008E           00244         movwf       count3              ; 
0067   2???           00245         call        DELAY               ; -30deg off time
                      00246         
0068   0008           00247         return
                      00248 
0069                  00249 MOTOR_PLUS30_ON:
MPASM 5.77                      MAINCODE.ASM   8-14-2021  20:31:35         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0069   3025           00250         movlw       d'37'               ; set layer 1 delay counter
006A   008C           00251         movwf       count1              ; 
006B   3003           00252         movlw       d'3'                ; set layer 2 delay counter
006C   008D           00253         movwf       count2              ; 
006D   3001           00254         movlw       d'1'                ; set layer 3 delay counter
006E   008E           00255         movwf       count3              ; 
006F   2???           00256         call        DELAY               ; +30deg on time
                      00257         
0070   0008           00258         return
                      00259         
0071                  00260 MOTOR_PLUS30_OFF:
0071   306A           00261         movlw       d'106'              ; set layer 1 delay counter
0072   008C           00262         movwf       count1              ; 
0073   3001           00263         movlw       d'1'                ; set layer 2 delay counter
0074   008D           00264         movwf       count2              ; 
0075   3001           00265         movlw       d'1'                ; set layer 3 delay counter
0076   008E           00266         movwf       count3              ; 
0077   2???           00267         call        DELAY               ; +30deg off time
                      00268         
0078   0008           00269         return
                      00270         
0079                  00271 DELAY_1S:
0079   308E           00272         movlw       d'142'              ; set layer 1 delay counter
007A   008C           00273         movwf       count1              ; 
007B   3013           00274         movlw       d'19'               ; set layer 2 delay counter
007C   008D           00275         movwf       count2              ; 
007D   3006           00276         movlw       d'6'                ; set layer 3 delay counter
007E   008E           00277         movwf       count3              ; 
007F   2???           00278         call        DELAY               ; +30deg off time
                      00279         
0080   0008           00280         return
                      00281         
                      00282 ;-------------------------------------------------------------------------------
0081                  00283 INF_LOOP:
0081   2???           00284         goto    $
                      00285 ;-------------------------------------------------------------------------------
                      00286         
                      00287 ;-------------------------------------------------------------------------------
                      00288         end
MPASM 5.77                      MAINCODE.ASM   8-14-2021  20:31:35         PAGE  7


SYMBOL TABLE
  LABEL                             VALUE 

C                                 00000000
DC                                00000001
DELAY                             00000032
DELAY_1S                          00000079
EEADR                             00000009
EECON1                            00000088
EECON2                            00000089
EEDATA                            00000008
EEIE                              00000006
EEIF                              00000004
F                                 00000001
FSR                               00000004
GIE                               00000007
INDF                              00000000
INF_LOOP                          00000081
INIT                              00000005
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IRP                               00000007
ISR                               00000031
MAIN                              00000013
MOTOR_0_OFF                       00000051
MOTOR_0_ON                        00000049
MOTOR_MINUS30_OFF                 00000061
MOTOR_MINUS30_ON                  00000059
MOTOR_PLUS30_OFF                  00000071
MOTOR_PLUS30_ON                   00000069
MOTOR_PLUS90_OFF                  00000041
MOTOR_PLUS90_ON                   00000039
NOT_PD                            00000003
NOT_RBPU                          00000007
NOT_TO                            00000004
OPTION_REG                        00000081
PCL                               00000002
PCLATH                            0000000A
PORTA                             00000005
PORTB                             00000006
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
RA0                               00000000
RA1                               00000001
RA2                               00000002
RA3                               00000003
RA4                               00000004
RB0                               00000000
RB1                               00000001
RB2                               00000002
RB3                               00000003
RB4                               00000004
MPASM 5.77                      MAINCODE.ASM   8-14-2021  20:31:35         PAGE  8


SYMBOL TABLE
  LABEL                             VALUE 

RB5                               00000005
RB6                               00000006
RB7                               00000007
RBIE                              00000003
RBIF                              00000000
RD                                00000000
READ_SENSOR_VALUE                 00000030
RP0                               00000005
RP1                               00000006
STATUS                            00000003
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
TMR0                              00000001
TMR0IE                            00000005
TMR0IF                            00000002
TRISA                             00000085
TRISA0                            00000000
TRISA1                            00000001
TRISA2                            00000002
TRISA3                            00000003
TRISA4                            00000004
TRISB                             00000086
TRISB0                            00000000
TRISB1                            00000001
TRISB2                            00000002
TRISB3                            00000003
TRISB4                            00000004
TRISB5                            00000005
TRISB6                            00000006
TRISB7                            00000007
W                                 00000000
WR                                00000001
WREN                              00000002
WRERR                             00000003
Z                                 00000002
_.org_1_0081                      00000081
_CONFIG                           00002007
_CP_OFF                           00003FFF
_CP_ON                            0000000F
_DEVID1                           00002006
_FOSC_EXTRC                       00003FFF
_FOSC_HS                          00003FFE
_FOSC_LP                          00003FFC
_FOSC_XT                          00003FFD
_HS_OSC                           00003FFE
_IDLOC0                           00002000
_IDLOC1                           00002001
_IDLOC2                           00002002
_IDLOC3                           00002003
_LP_OSC                           00003FFC
_PWRTE_OFF                        00003FFF
MPASM 5.77                      MAINCODE.ASM   8-14-2021  20:31:35         PAGE  9


SYMBOL TABLE
  LABEL                             VALUE 

_PWRTE_ON                         00003FF7
_RC_OSC                           00003FFF
_WDTE_OFF                         00003FFB
_WDTE_ON                          00003FFF
_WDT_OFF                          00003FFB
_WDT_ON                           00003FFF
_XT_OSC                           00003FFD
__16F84A                          00000001
__DEBUG                           
__MPLAB_DEBUGGER_PK3              1
count1                            0000000C
count2                            0000000D
count3                            0000000E

Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :     6 reported,     0 suppressed

