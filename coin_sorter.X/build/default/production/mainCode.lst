MPASM 5.77                      MAINCODE.ASM   8-17-2021  10:01:18         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ;-------------------------------------------------------------------------------
                      00002 ; EE322 Embedded Systems Design
                      00003 ; Year 3 Semester 1
                      00004 ; Group Project
                      00005 ; Title: Coin Sorter and Calculator
                      00006 ; 
                      00007 ; Group G1
                      00008 ;    E/17/146: Jayawickrama, J.P.D.D.M.
                      00009 ;    E/17/234: Pandukabhaya, V.K.M.
                      00010 ;    E/17/371: Warnakulasuriya, R.
                      00011 ;-------------------------------------------------------------------------------
                      00012 
                      00013 ;-------------------------------------------------------------------------------
                      00014 ; Header
                      00015 #include <p16f84a.inc>                  ; Include file for register names
                      00001         LIST
                      00002 
                      00003 ;==========================================================================
                      00004 ; Build date : Nov 22 2017
                      00005 ;  MPASM PIC16F84A processor include
                      00006 ; 
                      00007 ;  (c) Copyright 1999-2017 Microchip Technology, All rights reserved
                      00008 ;==========================================================================
                      00009 
                      00209         LIST
                      00016         list        p = 16f84a          ; Microcontroller model
                      00017 ;-------------------------------------------------------------------------------
                      00018 
                      00019 ;-------------------------------------------------------------------------------
                      00020 ; Pin Designations
                      00021 
                      00022 ;-------------------------------------------------------------------------------
                      00023 
                      00024 ;-------------------------------------------------------------------------------
                      00025 ; Variables
                      00026 ; Counter variables for delays
  0000000C            00027 count1  equ         0x0c                ; used in a decfsz
  0000000D            00028 count2  equ         0x0d                ; used in a decfsz
  0000000E            00029 count3  equ         0x0e                ; used in a decfsz
                      00030 ;-------------------------------------------------------------------------------
                      00031 
                      00032 ;-------------------------------------------------------------------------------
                      00033 ; Constants
                      00034 
                      00035 ;-------------------------------------------------------------------------------
                      00036 
                      00037 ;-------------------------------------------------------------------------------
                      00038 ; Define origin and interrupt vectors
                      00039         org         0x000               ; Origin
0000   2???           00040         goto        INIT
                      00041         
                      00042         org         0x04                ; Interrupt vector
0004   2???           00043         goto        ISR                 ; Unimplemented
MPASM 5.77                      MAINCODE.ASM   8-17-2021  10:01:18         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00044 ;-------------------------------------------------------------------------------
                      00045 
                      00046 ;-------------------------------------------------------------------------------
                      00047 ; Routine "INIT"
                      00048 ;       Executed once. Configures settings in PIC.
                      00049 
0005                  00050 INIT:
0005   1683           00051         bsf         STATUS, RP0         ; Bank 1 select (bit 5)
                      00052 
                      00053 ; Set Interrupt Settings
0006   160B           00054         bsf         INTCON, INTE        ; Enable the RB0/INT interrupt
                      00055         
0007   178B           00056         bsf         INTCON, GIE         ; Enable all un-masked (global)
                      00057                                         ; interrupts
                      00058                                     
0008   108B           00059         bcf         INTCON, INTF        ; Clear the RB0/INT flag
                      00060         
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0009   1701           00061         bsf         OPTION_REG, INTEDG  ; Interrupt on rising edge of
                      00062                                         ; RB0/INT pin
                      00063 
                      00064 ; Set PORTA, PORTB pin modes
000A   30FF           00065         movlw       b'11111111'         ; PORTB I/O pattern
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
000B   0086           00066         movwf       TRISB               ; Set PORTB pin modes
                      00067         
000C   3000           00068         movlw       b'00000000'         ; PORTA I/O pattern
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
000D   0085           00069         movwf       TRISA               ; Set PORTA pin modes
                      00070         
000E   1283           00071         bcf         STATUS, RP0         ; Bank 0 select
                      00072 
                      00073 ; Initialize PORTA and PORTB
000F   3000           00074         movlw       b'00000000'         ; All zeros
0010   0086           00075         movwf       PORTB
0011   3000           00076         movlw       b'00000000'         ; All zeros
0012   0085           00077         movwf       PORTA
                      00078         
                      00079 ; Initialize positions of the three motors to zero        
0013   3007           00080         movlw       b'00000111'         ; turn on RA0, RA1, RA2
0014   0085           00081         movwf       PORTA               ; 
0015   2???           00082         call        MOTOR_0_ON          ;
                      00083         
0016   3000           00084         movlw       b'00000000'         ; turn off RA0, RA1, RA2
0017   0085           00085         movwf       PORTA               ; 
0018   2???           00086         call        MOTOR_0_OFF         ;
                      00087         
0019   2???           00088         call        DELAY_1S
                      00089         
                      00090 ;-------------------------------------------------------------------------------
                      00091 
                      00092 ;-------------------------------------------------------------------------------
                      00093 ; Routine "MAIN"
MPASM 5.77                      MAINCODE.ASM   8-17-2021  10:01:18         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

001A                  00094 MAIN:
                      00095         ; The MAIN loop
                      00096         
001A   2???           00097         goto        MAIN                ; Go to the MAIN routine again (loop)
                      00098 
                      00099 ;-------------------------------------------------------------------------------
                      00100 ; Subroutine "READ_SENSOR_VALUE"
001B                  00101 READ_SENSOR_VALUE:
                      00102         ;        unsigned long Count;
                      00103         ;        unsigned char i;
                      00104     
                      00105 ;        pinMode(DT, OUTPUT);
001B   1683           00106         bsf         STATUS, RP0         ; Bank 1 select (bit 5)
001C   3000           00107         movlw       b'00000000'         ; PORTA I/O pattern
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
001D   0085           00108         movwf       TRISA               ; Set PORTA pin modes
                      00109         
                      00110 ;        digitalWrite(DT,HIGH);
                      00111 ;        digitalWrite(SCK,LOW);
001E   1283           00112         bcf         STATUS, RP0         ; Bank 0 select
001F   3010           00113         movlw       b'00010000'         ; turn on DOUT, turn off SCK
0020   0085           00114         movwf       PORTA               ; 
                      00115         
                      00116         ; count = 0
                      00117 
                      00118 ;        pinMode(DT, INPUT);
0021   1683           00119         bsf         STATUS, RP0         ; Bank 1 select (bit 5)
0022   3010           00120         movlw       b'00010000'         ; PORTA I/O pattern
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0023   0085           00121         movwf       TRISA               ; Set PORTA pin modes
                      00122         
0024   1283           00123         bcf         STATUS, RP0         ; Bank 0 select
                      00124 
                      00125 ;        while(digitalRead(DT));
0025                  00126 DOUT_1:
0025   1A05           00127         btfsc       PORTA, 4
0026   2???           00128         goto        DOUT_1
                      00129         
                      00130         ;        for (i = 0; i < 24; i++)
                      00131         ;        {
                      00132         ;          digitalWrite(SCK, HIGH);
                      00133         ;          Count = Count << 1;
                      00134         ;          digitalWrite(SCK, LOW);
                      00135         ;          if (digitalRead(DT)) 
                      00136         ;              Count++;
                      00137         ;        }
                      00138 
                      00139 ;        digitalWrite(SCK,HIGH);
0027   3008           00140         movlw       b'00001000'         ; turn on SCK
0028   0085           00141         movwf       PORTA               ; 
                      00142         
                      00143         ; Count = Count^0x800000;
                      00144         
MPASM 5.77                      MAINCODE.ASM   8-17-2021  10:01:18         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00145 ;        digitalWrite(SCK,LOW);
0029   3000           00146         movlw       b'00000000'         ; turn off SCK
002A   0085           00147         movwf       PORTA               ; 
                      00148         
                      00149         ; return(Count);
                      00150         
                      00151 ;-------------------------------------------------------------------------------
                      00152 ;        unsigned long Count;
                      00153 ;        unsigned char i;
                      00154 ;        pinMode(DT, OUTPUT);
                      00155 ;        digitalWrite(DT,HIGH);
                      00156 ;        digitalWrite(SCK,LOW);
                      00157 ;        Count=0
                      00158 ;        pinMode(DT, INPUT);
                      00159 ;        while(digitalRead(DT));
                      00160 ;        for (i=0; i<24; i++)
                      00161 ;        {
                      00162 ;          digitalWrite(SCK, HIGH);
                      00163 ;          Count = Count << 1;
                      00164 ;          digitalWrite(SCK, LOW);
                      00165 ;          if (digitalRead(DT)) 
                      00166 ;               Count++;
                      00167 ;        }
                      00168 ;        digitalWrite(SCK,HIGH);
                      00169 ;        Count=Count^0x800000;
                      00170 ;        digitalWrite(SCK,LOW);
                      00171 ;        return(Count);
                      00172 ;-------------------------------------------------------------------------------
                      00173         
002B   0008           00174         return
                      00175         
                      00176 ;-------------------------------------------------------------------------------
                      00177 ; ISR ""
002C                  00178 ISR:
                      00179         ; Interrupt occurred event
002C   0009           00180         retfie                          ; Return from interrupt
                      00181 ;-------------------------------------------------------------------------------
                      00182         
                      00183 ;-------------------------------------------------------------------------------
                      00184 ; Delay subroutine (general)
                      00185 ; T = 18 + (count1-1)*3 + (count2-1)*770 + (count3-1)*197140 ns
002D                  00186 DELAY
002D   0B8C           00187         decfsz      count1, f
002E   2???           00188         goto        DELAY
                      00189         
002F   0B8D           00190         decfsz      count2, f
0030   2???           00191         goto        DELAY
                      00192         
0031   0B8E           00193         decfsz      count3, f
0032   2???           00194         goto        DELAY
                      00195         
0033   0008           00196         return
                      00197 
MPASM 5.77                      MAINCODE.ASM   8-17-2021  10:01:18         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00198 ;-------------------------------------------------------------------------------
                      00199 
                      00200 ;-------------------------------------------------------------------------------
                      00201 ; Motor Controller subroutines
                      00202 
0034                  00203 MOTOR_PLUS90_ON:
0034   3095           00204         movlw       d'149'              ; set layer 1 delay counter
0035   008C           00205         movwf       count1              ; 
0036   3003           00206         movlw       d'3'                ; set layer 2 delay counter
0037   008D           00207         movwf       count2              ; 
0038   3001           00208         movlw       d'1'                ; set layer 3 delay counter
0039   008E           00209         movwf       count3              ; 
003A   2???           00210         call        DELAY               ; 90deg on time
                      00211         
003B   0008           00212         return
                      00213         
003C                  00214 MOTOR_PLUS90_OFF:
003C   3001           00215         movlw       d'1'                ; set layer 1 delay counter
003D   008C           00216         movwf       count1              ; 
003E   3001           00217         movlw       d'1'                ; set layer 2 delay counter
003F   008D           00218         movwf       count2              ; 
0040   3003           00219         movlw       d'3'                ; set layer 3 delay counter
0041   008E           00220         movwf       count3              ; 
0042   2???           00221         call        DELAY               ; 90deg off time
                      00222         
0043   0008           00223         return
                      00224 
0044                  00225 MOTOR_0_ON:
0044   30EE           00226         movlw       d'238'              ; set layer 1 delay counter
0045   008C           00227         movwf       count1              ; 
0046   3002           00228         movlw       d'2'                ; set layer 2 delay counter
0047   008D           00229         movwf       count2              ; 
0048   3001           00230         movlw       d'1'                ; set layer 3 delay counter
0049   008E           00231         movwf       count3              ; 
004A   2???           00232         call        DELAY               ; 0deg on time
                      00233         
004B   0008           00234         return
                      00235         
004C                  00236 MOTOR_0_OFF:
004C   30A1           00237         movlw       d'161'              ; set layer 1 delay counter
004D   008C           00238         movwf       count1              ; 
004E   3001           00239         movlw       d'1'                ; set layer 2 delay counter
004F   008D           00240         movwf       count2              ; 
0050   3001           00241         movlw       d'1'                ; set layer 3 delay counter
0051   008E           00242         movwf       count3              ; 
0052   2???           00243         call        DELAY               ; 0deg off time
                      00244         
0053   0008           00245         return
                      00246         
0054                  00247 MOTOR_MINUS30_ON:
0054   30B7           00248         movlw       d'183'              ; set layer 1 delay counter
0055   008C           00249         movwf       count1              ; 
0056   3002           00250         movlw       d'2'                ; set layer 2 delay counter
MPASM 5.77                      MAINCODE.ASM   8-17-2021  10:01:18         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0057   008D           00251         movwf       count2              ; 
0058   3001           00252         movlw       d'1'                ; set layer 3 delay counter
0059   008E           00253         movwf       count3              ; 
005A   2???           00254         call        DELAY               ; -30deg on time
                      00255         
005B   0008           00256         return
                      00257         
005C                  00258 MOTOR_MINUS30_OFF:
005C   30D9           00259         movlw       d'217'              ; set layer 1 delay counter
005D   008C           00260         movwf       count1              ; 
005E   3001           00261         movlw       d'1'                ; set layer 2 delay counter
005F   008D           00262         movwf       count2              ; 
0060   3001           00263         movlw       d'1'                ; set layer 3 delay counter
0061   008E           00264         movwf       count3              ; 
0062   2???           00265         call        DELAY               ; -30deg off time
                      00266         
0063   0008           00267         return
                      00268 
0064                  00269 MOTOR_PLUS30_ON:
0064   3025           00270         movlw       d'37'               ; set layer 1 delay counter
0065   008C           00271         movwf       count1              ; 
0066   3003           00272         movlw       d'3'                ; set layer 2 delay counter
0067   008D           00273         movwf       count2              ; 
0068   3001           00274         movlw       d'1'                ; set layer 3 delay counter
0069   008E           00275         movwf       count3              ; 
006A   2???           00276         call        DELAY               ; +30deg on time
                      00277         
006B   0008           00278         return
                      00279         
006C                  00280 MOTOR_PLUS30_OFF:
006C   306A           00281         movlw       d'106'              ; set layer 1 delay counter
006D   008C           00282         movwf       count1              ; 
006E   3001           00283         movlw       d'1'                ; set layer 2 delay counter
006F   008D           00284         movwf       count2              ; 
0070   3001           00285         movlw       d'1'                ; set layer 3 delay counter
0071   008E           00286         movwf       count3              ; 
0072   2???           00287         call        DELAY               ; +30deg off time
                      00288         
0073   0008           00289         return
                      00290         
0074                  00291 DELAY_1S:
0074   308E           00292         movlw       d'142'              ; set layer 1 delay counter
0075   008C           00293         movwf       count1              ; 
0076   3013           00294         movlw       d'19'               ; set layer 2 delay counter
0077   008D           00295         movwf       count2              ; 
0078   3006           00296         movlw       d'6'                ; set layer 3 delay counter
0079   008E           00297         movwf       count3              ; 
007A   2???           00298         call        DELAY               ; +30deg off time
                      00299         
007B   0008           00300         return
                      00301         
                      00302 ;-------------------------------------------------------------------------------
007C                  00303 INF_LOOP:
MPASM 5.77                      MAINCODE.ASM   8-17-2021  10:01:18         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

007C   2???           00304         goto    $
                      00305 ;-------------------------------------------------------------------------------
                      00306         
                      00307 ;-------------------------------------------------------------------------------
                      00308         end
MPASM 5.77                      MAINCODE.ASM   8-17-2021  10:01:18         PAGE  8


SYMBOL TABLE
  LABEL                             VALUE 

C                                 00000000
DC                                00000001
DELAY                             0000002D
DELAY_1S                          00000074
DOUT_1                            00000025
EEADR                             00000009
EECON1                            00000088
EECON2                            00000089
EEDATA                            00000008
EEIE                              00000006
EEIF                              00000004
F                                 00000001
FSR                               00000004
GIE                               00000007
INDF                              00000000
INF_LOOP                          0000007C
INIT                              00000005
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IRP                               00000007
ISR                               0000002C
MAIN                              0000001A
MOTOR_0_OFF                       0000004C
MOTOR_0_ON                        00000044
MOTOR_MINUS30_OFF                 0000005C
MOTOR_MINUS30_ON                  00000054
MOTOR_PLUS30_OFF                  0000006C
MOTOR_PLUS30_ON                   00000064
MOTOR_PLUS90_OFF                  0000003C
MOTOR_PLUS90_ON                   00000034
NOT_PD                            00000003
NOT_RBPU                          00000007
NOT_TO                            00000004
OPTION_REG                        00000081
PCL                               00000002
PCLATH                            0000000A
PORTA                             00000005
PORTB                             00000006
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
RA0                               00000000
RA1                               00000001
RA2                               00000002
RA3                               00000003
RA4                               00000004
RB0                               00000000
RB1                               00000001
RB2                               00000002
RB3                               00000003
MPASM 5.77                      MAINCODE.ASM   8-17-2021  10:01:18         PAGE  9


SYMBOL TABLE
  LABEL                             VALUE 

RB4                               00000004
RB5                               00000005
RB6                               00000006
RB7                               00000007
RBIE                              00000003
RBIF                              00000000
RD                                00000000
READ_SENSOR_VALUE                 0000001B
RP0                               00000005
RP1                               00000006
STATUS                            00000003
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
TMR0                              00000001
TMR0IE                            00000005
TMR0IF                            00000002
TRISA                             00000085
TRISA0                            00000000
TRISA1                            00000001
TRISA2                            00000002
TRISA3                            00000003
TRISA4                            00000004
TRISB                             00000086
TRISB0                            00000000
TRISB1                            00000001
TRISB2                            00000002
TRISB3                            00000003
TRISB4                            00000004
TRISB5                            00000005
TRISB6                            00000006
TRISB7                            00000007
W                                 00000000
WR                                00000001
WREN                              00000002
WRERR                             00000003
Z                                 00000002
_.org_1_007C                      0000007C
_CONFIG                           00002007
_CP_OFF                           00003FFF
_CP_ON                            0000000F
_DEVID1                           00002006
_FOSC_EXTRC                       00003FFF
_FOSC_HS                          00003FFE
_FOSC_LP                          00003FFC
_FOSC_XT                          00003FFD
_HS_OSC                           00003FFE
_IDLOC0                           00002000
_IDLOC1                           00002001
_IDLOC2                           00002002
_IDLOC3                           00002003
_LP_OSC                           00003FFC
MPASM 5.77                      MAINCODE.ASM   8-17-2021  10:01:18         PAGE 10


SYMBOL TABLE
  LABEL                             VALUE 

_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FF7
_RC_OSC                           00003FFF
_WDTE_OFF                         00003FFB
_WDTE_ON                          00003FFF
_WDT_OFF                          00003FFB
_WDT_ON                           00003FFF
_XT_OSC                           00003FFD
__16F84A                          00000001
count1                            0000000C
count2                            0000000D
count3                            0000000E

Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :     5 reported,     0 suppressed

